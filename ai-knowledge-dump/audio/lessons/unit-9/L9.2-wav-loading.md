# L9.2: WAV File Loading & Playback

**Unit 9: Game Audio Architecture Patterns**  
**Estimated Time:** 75-90 minutes  
**Competence Target:** Level 5 (Synthesis)

---

## Learning Objectives

1. **Parse** WAV file header (RIFF format)
2. **Load** PCM audio data into memory
3. **Handle** different sample rates and formats
4. **Convert** to game's native format
5. **Stream** large files vs preload small ones

---

## WAV File Format

```
┌────────────────────┐
│ RIFF Header        │ 12 bytes
│ - "RIFF"           │
│ - File size        │
│ - "WAVE"           │
├────────────────────┤
│ fmt Chunk          │ 24 bytes
│ - Sample rate      │
│ - Channels         │
│ - Bits per sample  │
├────────────────────┤
│ data Chunk         │ 8+ bytes
│ - "data"           │
│ - Data size        │
│ - PCM samples...   │
└────────────────────┘
```

---

## Simple WAV Loader

```c
typedef struct {
  int16_t *samples;
  int sample_count;
  int channels;
  int sample_rate;
} WavFile;

WavFile* LoadWav(const char *filename) {
  FILE *f = fopen(filename, "rb");
  if (!f) return NULL;
  
  // Read RIFF header
  char riff[4];
  fread(riff, 1, 4, f);
  if (memcmp(riff, "RIFF", 4) != 0) return NULL;
  
  fseek(f, 4, SEEK_CUR);  // Skip file size
  
  char wave[4];
  fread(wave, 1, 4, f);
  if (memcmp(wave, "WAVE", 4) != 0) return NULL;
  
  // Find fmt chunk
  char fmt[4];
  fread(fmt, 1, 4, f);
  if (memcmp(fmt, "fmt ", 4) != 0) return NULL;
  
  uint32_t fmt_size;
  fread(&fmt_size, 4, 1, f);
  
  uint16_t audio_format;
  fread(&audio_format, 2, 1, f);
  if (audio_format != 1) return NULL;  // Only PCM
  
  uint16_t channels;
  fread(&channels, 2, 1, f);
  
  uint32_t sample_rate;
  fread(&sample_rate, 4, 1, f);
  
  fseek(f, 6, SEEK_CUR);  // Skip byte rate, block align
  
  uint16_t bits_per_sample;
  fread(&bits_per_sample, 2, 1, f);
  if (bits_per_sample != 16) return NULL;  // Only 16-bit
  
  // Find data chunk
  char data[4];
  fread(data, 1, 4, f);
  while (memcmp(data, "data", 4) != 0) {
    uint32_t chunk_size;
    fread(&chunk_size, 4, 1, f);
    fseek(f, chunk_size, SEEK_CUR);
    fread(data, 1, 4, f);
  }
  
  uint32_t data_size;
  fread(&data_size, 4, 1, f);
  
  int sample_count = data_size / (channels * 2);
  
  WavFile *wav = malloc(sizeof(WavFile));
  wav->samples = malloc(data_size);
  wav->sample_count = sample_count;
  wav->channels = channels;
  wav->sample_rate = sample_rate;
  
  fread(wav->samples, data_size, 1, f);
  fclose(f);
  
  return wav;
}
```

---

## Usage

```c
// Load at startup
WavFile *gunshot = LoadWav("sounds/gun.wav");

// Play in game
AudioMixer_Play(&mixer, gunshot->samples, gunshot->sample_count, 0.8f, false);
```

---

**Estimated Completion Time:** 75-90 minutes  
**Difficulty:** ⭐⭐⭐☆☆ (Medium)

**Progress:** Unit 9 is 67% complete! (2/3 lessons)

